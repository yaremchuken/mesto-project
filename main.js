(()=>{"use strict";var t="https://nomoreparties.co/v1/plus-cohort-6",e=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2?arguments[2]:void 0;return fetch("".concat(t).concat(e),{method:r,headers:{authorization:"c677fa90-7905-4374-86f2-1b0b7555aa56","Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(t){return t.ok?t.json():Promise.reject("Unable fetch requesting ".concat(url,", reason: ").concat(t.status))}))},r={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__btn-submit",inactiveButtonClass:"popup__btn-submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"},n=function(t){t.classList.add("popup_opened"),document.addEventListener("keydown",c)},o=function(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",c)},c=function(t){if("Escape"===t.key){var e=document.querySelector(".popup_opened");e&&o(e)}},a=function(t,e,r){e.classList.remove(r.inputErrorClass);var n=t.querySelector(".".concat(e.id,"-input-error"));n.classList.remove(r.errorClass),n.textContent=""},i=function(t,e,r){return e.validity.valid?a(t,e,r):function(t,e,r,n){e.classList.add(r.inputErrorClass);var o=t.querySelector(".".concat(e.id,"-input-error"));o.textContent=n,o.classList.add(r.errorClass)}(t,e,r,e.validationMessage),e.validity.valid},u=function(t,e){return Array.from(t.querySelectorAll(e.inputSelector)).map((function(r){return i(t,r,e)})).reduce((function(t,e){return t&&e}))},l=function(t,e){var r=t.querySelector(e.submitButtonSelector);Array.from(t.querySelectorAll(e.inputSelector)).some((function(t){return!t.validity.valid}))?(r.classList.add(e.inactiveButtonClass),r.disabled=!0):(r.classList.remove(e.inactiveButtonClass),r.disabled=!1)},s=function(t,e){!function(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(r){return a(t,r,e)}))}(t.querySelector(".popup__form"),e),o(t)},d=function(t){alert("Произошла ошибка загрузки данных ".concat(t.message))},p=document.querySelector("#avatar-popup"),f=p.querySelector("#avatar-link"),v=document.querySelector(".profile__avatar-img"),_=p.querySelector(".popup__form");_.addEventListener("submit",(function(t){if(t.preventDefault(),u(t.target,r)){var n,o=t.submitter;o.textContent="Сохранение...",(n=f.value,e("/users/me/avatar","PATCH",{avatar:n})).then((function(t){v.src=f.value,s(p,r)})).catch(d).finally((function(){return o.textContent="Сохранить"}))}}));var m,y=document.querySelector("#viewer-popup"),S=y.querySelector(".viewer__image"),b=y.querySelector(".viewer__caption"),h=function(t,e){S.src=t,S.alt=e,b.textContent=e,n(y)},q=document.querySelector(".profile__title"),g=document.querySelector(".profile__subtitle"),C=document.querySelector(".profile__avatar-img"),E=document.querySelector(".cards__list"),L=document.querySelector("#card-template").content.querySelector(".card"),k=function(t,e,r,n){var o,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=L.cloneNode(!0);a.querySelector(".card__title").textContent=e,a.id=t;var i=a.querySelector(".card__image");if(i.src=r,i.alt=e,i.addEventListener("click",(function(){return h(r,e)})),a.querySelector(".card__btn-like").addEventListener("click",w),null!=n&&n.find((function(t){return t._id===m}))&&a.querySelector(".card__btn-like").classList.add("card__btn-like_active"),T(a,null!==(o=null==n?void 0:n.length)&&void 0!==o?o:0),c){var u=a.querySelector(".card__btn-remove");u.addEventListener("click",(function(e){return A(e,t)})),u.classList.add("card__btn-remove_visible")}return a},x=function(t,e){t.prepend(e)},A=function(t,r){var n;(n=r,e("/cards/".concat(n),"DELETE")).then((function(e){return t.target.closest(".card").remove()})).catch(d)},w=function(t){var r,n=t.target.closest(".card");t.target.classList.contains("card__btn-like_active")?(r=n.id,e("/cards/likes/".concat(r),"DELETE")).then((function(e){t.target.classList.remove("card__btn-like_active"),T(n,e.likes.length)})).catch(d):function(t){return e("/cards/likes/".concat(t),"PUT")}(n.id).then((function(e){t.target.classList.add("card__btn-like_active"),T(n,e.likes.length)})).catch(d)},T=function(t,e){t.querySelector(".card__likes").textContent=e},j=document.querySelector("#card-popup"),P=j.querySelector("#title"),B=j.querySelector("#link"),D=j.querySelector(".popup__form");D.addEventListener("submit",(function(t){t.preventDefault();var n=P.value,o=B.value,c=t.submitter;c.textContent="Сохранение...",u(t.target,r)&&function(t,r){return e("/cards","POST",{name:t,link:r})}(n,o).then((function(t){var e;e=k(t._id,n,o),x(E,e),s(j,r)})).catch(d).finally((function(){return c.textContent="Сохранить"}))}));var O=document.querySelector("#profile-popup"),I=O.querySelector("#name"),U=O.querySelector("#appointment"),H=O.querySelector(".popup__form");function M(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}H.addEventListener("submit",(function(t){if(t.preventDefault(),u(t.target,r)){var n,o=t.submitter;o.textContent="Сохранение...",(n={name:I.value,about:U.value},e("/users/me","PATCH",n)).then((function(t){q.textContent=I.value,g.textContent=U.value,s(O,r)})).catch(d).finally((function(){return o.textContent="Сохранить"}))}})),function(t){document.querySelectorAll(t.formSelector).forEach((function(e){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(r){r.addEventListener("input",(function(){i(e,r,t),l(e,t)}))}))}))}(r),document.querySelectorAll(".popup").forEach((function(t){t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup_opened")&&o(t),e.target.classList.contains("popup__btn-close")&&o(t)}))})),document.querySelector(".profile__btn-add").addEventListener("click",(function(){P.value="",B.value="",l(D,r),n(j)})),document.querySelector(".profile__btn-edit").addEventListener("click",(function(){I.value=q.textContent,U.value=g.textContent,l(H,r),n(O)})),document.querySelector(".profile__avatar-edit").addEventListener("click",(function(){f.value="",l(_,r),n(p)})),Promise.all([e("/users/me"),e("/cards")]).then((function(t){var e,r,n,o=(n=2,function(t){if(Array.isArray(t))return t}(r=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,c=[],a=!0,i=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(c.push(n.value),!e||c.length!==e);a=!0);}catch(t){i=!0,o=t}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return c}}(r,n)||function(t,e){if(t){if("string"==typeof t)return M(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?M(t,e):void 0}}(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];m=(e=c)._id,q.textContent=e.name,g.textContent=e.about,C.src=e.avatar,function(t){t.forEach((function(t){var e=t.owner._id===m;x(E,k(t._id,t.name,t.link,t.likes,e))}))}(a)})).catch(d)})();