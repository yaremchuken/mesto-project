(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{w:()=>M});var t,r=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)},n=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)},o=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&n(t)}},c=document.querySelector("#viewer-popup"),a=c.querySelector(".viewer__image"),u=c.querySelector(".viewer__caption"),i=function(e,t){a.src=e,a.alt=t,u.textContent=t,r(c)},l=document.querySelector(".profile__title"),s=document.querySelector(".profile__subtitle"),d=document.querySelector(".profile__avatar-img"),p=function(e,t,r){t.classList.remove(r.inputErrorClass);var n=e.querySelector(".".concat(t.id,"-input-error"));n.classList.remove(r.errorClass),n.textContent=""},v=function(e,t,r){return t.validity.valid?p(e,t,r):function(e,t,r,n){t.classList.add(r.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-input-error"));o.textContent=n,o.classList.add(r.errorClass)}(e,t,r,t.validationMessage),t.validity.valid},f=function(e,t){return Array.from(e.querySelectorAll(t.inputSelector)).map((function(r){return v(e,r,t)})).reduce((function(e,t){return e&&t}))},_=function(e,t){var r=e.querySelector(t.submitButtonSelector);Array.from(e.querySelectorAll(t.inputSelector)).some((function(e){return!e.validity.valid}))?(r.classList.add(t.inactiveButtonClass),r.disabled=!0):(r.classList.remove(t.inactiveButtonClass),r.disabled=!1)},m=function(e,t,r){t.textContent="Сохранить",function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(r){return p(e,r,t)}))}(e.querySelector(".popup__form"),r),n(e)},y=function(e){alert("Произошла ошибка загрузки данных ".concat(e.message))},S=document.querySelector(".cards__list"),q=document.querySelector("#card-template").content.querySelector(".card"),b=function(e,r,n,o){var c,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=q.cloneNode(!0);u.querySelector(".card__title").textContent=r,u.id=e;var l=u.querySelector(".card__image");if(l.src=n,l.alt=r,l.addEventListener("click",(function(){return i(n,r)})),u.querySelector(".card__btn-like").addEventListener("click",E),null!=o&&o.find((function(e){return e._id===t}))&&u.querySelector(".card__btn-like").classList.add("card__btn-like_active"),g(u,null!==(c=null==o?void 0:o.length)&&void 0!==c?c:0),a){var s=u.querySelector(".card__btn-remove");s.addEventListener("click",(function(t){return L(t,e)})),s.classList.add("card__btn-remove_visible")}return u},h=function(e,t){e.prepend(t)},L=function(e,t){x(t).then((function(t){return e.target.closest(".card").remove()})).catch(y)},E=function(e){var t=e.target.closest(".card");e.target.classList.contains("card__btn-like_active")?(e.target.classList.remove("card__btn-like_active"),w(t.id).then((function(e){return g(t,e.likes.length)})).catch(y)):(e.target.classList.add("card__btn-like_active"),A(t.id).then((function(e){return g(t,e.likes.length)})).catch(y))},g=function(e,t){e.querySelector(".card__likes").textContent=t},C="https://nomoreparties.co/v1/plus-cohort-6",k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments.length>2?arguments[2]:void 0;return fetch(e,{method:t,headers:{authorization:"c677fa90-7905-4374-86f2-1b0b7555aa56","Content-Type":"application/json"},body:JSON.stringify(r)}).then((function(t){return t.ok?t.json():Promise.reject("Unable fetch requesting ".concat(e,", reason: ").concat(t.status))}))},x=function(e){return k("".concat(C,"/cards/").concat(e),"DELETE")},A=function(e){return k("".concat(C,"/cards/likes/").concat(e),"PUT")},w=function(e){return k("".concat(C,"/cards/likes/").concat(e),"DELETE")},T=document.querySelector("#avatar-popup"),P=T.querySelector("#avatar-link"),j=document.querySelector(".profile__avatar-img"),B=T.querySelector(".popup__form");B.addEventListener("submit",(function(e){if(e.preventDefault(),f(e.target,M)){j.src=P.value;var t,r=e.target.querySelector(".popup__btn-submit");r.textContent="Сохранение...",(t=P.value,k("".concat(C,"/users/me/avatar"),"PATCH",{avatar:t})).then((function(e){return m(T,r,M)})).catch(y)}}));var D=document.querySelector("#card-popup"),O=D.querySelector("#title"),H=D.querySelector("#link"),N=D.querySelector(".popup__form");N.addEventListener("submit",(function(e){e.preventDefault();var t=O.value,r=H.value,n=e.target.querySelector(".popup__btn-submit");n.textContent="Сохранение...",f(e.target,M)&&function(e,t){return k("".concat(C,"/cards"),"POST",{name:e,link:t})}(t,r).then((function(e){var o;o=b(e._id,t,r),h(S,o),m(D,n,M)})).catch(y)}));var U=document.querySelector("#profile-popup"),z=U.querySelector("#name"),G=U.querySelector("#appointment"),J=U.querySelector(".popup__form");J.addEventListener("submit",(function(e){if(e.preventDefault(),f(e.target,M)){l.textContent=z.value,s.textContent=G.value;var t,r=e.target.querySelector(".popup__btn-submit");r.textContent="Сохранение...",(t={name:z.value,about:G.value},k("".concat(C,"/users/me"),"PATCH",t)).then((function(e){return m(U,r,M)})).catch(y)}}));var M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__btn-submit",inactiveButtonClass:"popup__btn-submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"};!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(r){r.addEventListener("input",(function(){v(t,r,e),_(t,e)}))}))}))}(M),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&n(e),t.target.classList.contains("popup__btn-close")&&n(e)}))})),document.querySelector(".profile__btn-add").addEventListener("click",(function(){O.value="",H.value="",_(N,M),r(D)})),document.querySelector(".profile__btn-edit").addEventListener("click",(function(){z.value=l.textContent,G.value=s.textContent,_(J,M),r(U)})),document.querySelector(".profile__avatar-edit").addEventListener("click",(function(){P.value="",_(B,M),r(T)})),k("".concat(C,"/users/me")).then((function(e){return t=(r=e)._id,l.textContent=r.name,s.textContent=r.about,void(d.src=r.avatar);var r})).then((function(e){return k("".concat(C,"/cards"))})).then((function(e){e.forEach((function(e){var r=e.owner._id===t;h(S,b(e._id,e.name,e.link,e.likes,r))}))})).catch(y)})();