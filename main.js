(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{w:()=>G});var t,r=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",o)},n=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",o)},o=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&n(t)}},c=document.querySelector("#viewer-popup"),a=c.querySelector(".viewer__image"),u=c.querySelector(".viewer__caption"),i=function(e,t){a.src=e,a.alt=t,u.textContent=t,r(c)},l=document.querySelector(".profile__title"),s=document.querySelector(".profile__subtitle"),d=document.querySelector(".profile__avatar-img"),p=function(e,t,r){t.textContent="Сохранить",hideFormErrors(e.querySelector(".popup__form"),r),closePopup(e)},v=function(e){alert("Произошла ошибка загрузки данных ".concat(e.message))},_=document.querySelector(".cards__list"),f=document.querySelector("#card-template").content.querySelector(".card"),m=function(e,r,n,o){var c,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=f.cloneNode(!0);u.querySelector(".card__title").textContent=r,u.id=e;var l=u.querySelector(".card__image");if(l.src=n,l.alt=r,l.addEventListener("click",(function(){return i(n,r)})),u.querySelector(".card__btn-like").addEventListener("click",q),null!=o&&o.find((function(e){return e._id===t}))&&u.querySelector(".card__btn-like").classList.add("card__btn-like_active"),b(u,null!==(c=null==o?void 0:o.length)&&void 0!==c?c:0),a){var s=u.querySelector(".card__btn-remove");s.addEventListener("click",(function(t){return S(t,e)})),s.classList.add("card__btn-remove_visible")}return u},y=function(e,t){e.prepend(t)},S=function(e,t){E(t).then((function(t){return e.target.closest(".card").remove()})).catch(v)},q=function(e){var t=e.target.closest(".card");e.target.classList.contains("card__btn-like_active")?(e.target.classList.remove("card__btn-like_active"),C(t.id).then((function(e){return b(t,e.likes.length)})).catch(v)):(e.target.classList.add("card__btn-like_active"),g(t.id).then((function(e){return b(t,e.likes.length)})).catch(v))},b=function(e,t){e.querySelector(".card__likes").textContent=t},h="https://nomoreparties.co/v1/plus-cohort-6",L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments.length>2?arguments[2]:void 0;return fetch(e,{method:t,headers:{authorization:"c677fa90-7905-4374-86f2-1b0b7555aa56","Content-Type":"application/json"},body:JSON.stringify(r)}).then((function(t){return t.ok?t.json():Promise.reject("Unable fetch requesting ".concat(e,", reason: ").concat(t.status))}))},E=function(e){return L("".concat(h,"/cards/").concat(e),"DELETE")},g=function(e){return L("".concat(h,"/cards/likes/").concat(e),"PUT")},C=function(e){return L("".concat(h,"/cards/likes/").concat(e),"DELETE")},k=function(e,t,r){return t.validity.valid?function(e,t,r){t.classList.remove(r.inputErrorClass);var n=e.querySelector(".".concat(t.id,"-input-error"));n.classList.remove(r.errorClass),n.textContent=""}(e,t,r):function(e,t,r,n){t.classList.add(r.inputErrorClass);var o=e.querySelector(".".concat(t.id,"-input-error"));o.textContent=n,o.classList.add(r.errorClass)}(e,t,r,t.validationMessage),t.validity.valid},x=function(e,t){return Array.from(e.querySelectorAll(t.inputSelector)).map((function(r){return k(e,r,t)})).reduce((function(e,t){return e&&t}))},A=function(e,t){var r=e.querySelector(t.submitButtonSelector);Array.from(e.querySelectorAll(t.inputSelector)).some((function(e){return!e.validity.valid}))?(r.classList.add(t.inactiveButtonClass),r.disabled=!0):(r.classList.remove(t.inactiveButtonClass),r.disabled=!1)},w=document.querySelector("#avatar-popup"),P=w.querySelector("#avatar-link"),T=document.querySelector(".profile__avatar-img"),j=w.querySelector(".popup__form");j.addEventListener("submit",(function(e){if(e.preventDefault(),x(e.target,G)){T.src=P.value;var t,r=e.target.querySelector(".popup__btn-submit");r.textContent="Сохранение...",(t=P.value,L("".concat(h,"/users/me/avatar"),"PATCH",{avatar:t})).then((function(e){return p(w,r,G)})).catch(v)}}));var B=document.querySelector("#card-popup"),D=B.querySelector("#title"),O=B.querySelector("#link"),H=B.querySelector(".popup__form");H.addEventListener("submit",(function(e){e.preventDefault();var t=D.value,r=O.value,n=e.target.querySelector(".popup__btn-submit");n.textContent="Сохранение...",x(e.target,G)&&function(e,t){return L("".concat(h,"/cards"),"POST",{name:e,link:t})}(t,r).then((function(e){var o;o=m(e._id,t,r),y(_,o),p(B,n,G)})).catch(v)}));var N=document.querySelector("#profile-popup"),U=N.querySelector("#name"),z=N.querySelector("#appointment"),F=N.querySelector(".popup__form");F.addEventListener("submit",(function(e){if(e.preventDefault(),x(e.target,G)){l.textContent=U.value,s.textContent=z.value;var t,r=e.target.querySelector(".popup__btn-submit");r.textContent="Сохранение...",(t={name:U.value,about:z.value},L("".concat(h,"/users/me"),"PATCH",t)).then((function(e){return p(N,r,G)})).catch(v)}}));var G={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__btn-submit",inactiveButtonClass:"popup__btn-submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_visible"};!function(e){document.querySelectorAll(e.formSelector).forEach((function(t){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(r){r.addEventListener("input",(function(){k(t,r,e),A(t,e)}))}))}))}(G),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&n(e),t.target.classList.contains("popup__btn-close")&&n(e)}))})),document.querySelector(".profile__btn-add").addEventListener("click",(function(){D.value="",O.value="",A(H,G),r(B)})),document.querySelector(".profile__btn-edit").addEventListener("click",(function(){U.value=l.textContent,z.value=s.textContent,A(F,G),r(N)})),document.querySelector(".profile__avatar-edit").addEventListener("click",(function(){P.value="",A(j,G),r(w)})),L("".concat(h,"/users/me")).then((function(e){return t=(r=e)._id,l.textContent=r.name,s.textContent=r.about,void(d.src=r.avatar);var r})).then((function(e){return L("".concat(h,"/cards"))})).then((function(e){e.forEach((function(e){var r=e.owner._id===t;y(_,m(e._id,e.name,e.link,e.likes,r))}))})).catch(v)})();